---
layout: post
title:  "Naive Bayesian Spam Filter"
date: 2016-01-10 19:01:42
categories: "algorithm"
author: xxiieao
---

垃圾信息的判别是现在互联网上越来越必不可少的一项功能，那么这个功能到底是如何实现的呢？

首先，我们需要收集一个垃圾信息库和一个正常信息库，然后对比这两个库中的词频。例如垃圾信息库里面“兼职”这个词汇出现了48次，而正常库里面“兼职”这个词出现了2次。如果我们现在获得一条新的信息，里面含有“兼职”一词的话，那么这条信息是垃圾信息的概率就是$$2/(2+48)=0.96$$。

而一条信息里面往往包含多个词汇，多个词汇情况下的后验概率又怎么计算呢？比如我有一条信息中包含“轻松”和“每日”两个词，其中“轻松”的垃圾概率是40%，而“每日”的垃圾概率是70%。一种常见的错误理解就是认为垃圾的概率是$$0.4*0.7$$或者$$(1-0.4)*(1-0.7)$$。前一种的思路是认为当“轻松”和“每日”的判定都成立时，那么该信息就是垃圾信息了。产生这种误解的原因是误用了相互独立条件。抛两次硬币得到两个正面的概率是0.5×0.5=0.25，第一次抛硬币的结果不会对第二次抛造成影响，这是相互独立的。而垃圾判定则不是，如果我们根据“轻松”判定了该信息是垃圾或者不是垃圾，这个结果会影响到“每日”的判定，这两个判定指向的实际上是一个结果，因此相互独立并不成立。

先解释一个表达式，$$P(A\|B)$$表示已知B的情况下A的概率。我们要求的目标就是$$P(垃圾\|轻松,每日)$$即出现“轻松”和“每日”时垃圾的概率。因为有

$$P(垃圾\|轻松,每日)P(轻松,每日) = P( 轻松,每日\|垃圾)P(垃圾)$$

所以

$$P(垃圾\|轻松,每日) = P(轻松,每日\|垃圾)P(垃圾) / P(轻松,每日)$$

求解中需要知道$$P(轻松,每日)$$也就是“轻松”和“每日”的联合概率，这个东西很麻烦，意味着你需要计算任意两个词联合概率，$$P(轻松,每日\|垃圾)$$也有同样的效果，需要记录垃圾邮件里任意两个词联合概率。现在还只是用到了两个词，如果是三个、四个……。这是一个不可能完成的任务。

一劳永逸解决的方法就是假设 “轻松”和“每日”出现的概率是相互独立的。这一步是最让人费解，因为前面不是说不独立了吗？首先需要区分两个概念

1. $$P(垃圾\|轻松)$$  已知包含“轻松”一词，邮件是垃圾的概率

2. $$P(轻松\|垃圾)$$  已知是垃圾邮件，包含“轻松”一词的概率

前面说的是情况1中的$$P(垃圾\|轻松)$$和$$P(垃圾\|每日)$$是不相互独立的，而情况2中的$$P(轻松\|垃圾)$$和$$P(每日\|垃圾)$$是相互独立的。

换句话说即

$$P(垃圾\|轻松,每日) ≠ P(垃圾\|轻松)P(垃圾\|每日)$$

这也是为什么不能两个概率直接相乘的原因，不过下面的两个式子是成立的

$$P(轻松,每日\|垃圾) = P(轻松\|垃圾)P(每日\|垃圾)$$

$$P(轻松,每日) = P(轻松)P(每日)$$

那么上面的公式

$$P(垃圾\|轻松,每日) = \dfrac{P(轻松\|垃圾)P(每日\|垃圾)P(垃圾)}{P(轻松)P(每日)}$$

在正式求解时往往使用以下形式

$$\dfrac{P(垃圾\|轻松,每日)}{P(非垃圾\|轻松,每日)}

= \dfrac{P(轻松\|垃圾)P(每日\|垃圾)P(垃圾)}{P(轻松\|非垃圾)P(每日\|非垃圾)P(非垃圾)}$$