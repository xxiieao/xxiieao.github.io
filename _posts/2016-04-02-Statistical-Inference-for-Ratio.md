---
layout: post
title:  "Statistical Inference for Ratio"
date: 2016-04-02 23:04:55 +0800
categories: "math"
author: xxiieao
---

## 关于转化率的统计推断

这个本星期工作中碰到的一个实际的问题。

假设已知全部用户群体的某事件X转化率是0.005，目前有一个运营活动，随机抽取了500位用户参加，活动中n名用户发生X行为。问这个n值要大于多少，才能认为该运营活动的转化率显著高于0.005？

如果机械地去照搬t检验，统计人员会发现自己处于非常难过的境地——因为判断某个数值是否显著大于某个分布的平均值，有赖于这个分布的方差。显然在上面这个情况中，这个转化率并没有方差。如果从最大似然率出发，导致n名用户出现的结果，那么运营活动最有可能的转化率就是n/500。这并没有什么用，因为直接比较n/500和0.005的大小显然是非常不靠谱的方法。因为假设n=3，我们能猜想到，即是在转化率是0.005的情况下得到这个结果的概率是非常大的，也就是说并不因为3/500 = 0.006大于0.005我们就会认为这个活动的转化率是显著高于0.005的。

如果仔细思考t检验的本质，你会发现实际上考察的是在某一设定条件（即需要考察的标准）下事情的发生概率。没错，在上面这个例子中，计算概率是非常自然而简单的事情，我们需要考察的标准就是转化率。

那么我们可以小心地提出第一个需要考察的事件。在转化率为0.005的条件下，500个抽样用户中没有一个人购买的概率，显然应该是

$$ (1-0.005)^500 \approx 0.0816 $$

500个用户中有一个人购买的概率

$$ (1-0.005)^499 * 0.005^1 * 500 \approx 0.205 $$

500个用户中有两个人购买的概率

$$ (1-0.005)^498 * 0.005^2 * \binom{2}{500} \approx 0.543 $$

显然我们不需要再继续下去了，这是$$ (0.995 + 0.005)^500 $$的展开式，就是个二次项分布。在R的帮助下，我们也能轻松获得这个分布的图像

{% highlight R linenos %}

plot(0:500, dbinom(0:500, 500, 0.005), typ = 'l', ylab = 'probability', xlab = 'num of customer')

plot(0:10, pbinom(0:10, 500, 0.005), typ = 'l', ylab = 'probability', xlab = 'num of customer', ylim = c(0, 1))

{% endhighlight %}

![picture](http://ww3.sinaimg.cn/mw690/6daafd01gw1f2itor4bq1j20dc0dcglq.jpg)

显然曲线下面所有的面积加一块就是1。为了方便查看，我们可以把分布图转换成累计分布图，和我们认知的一样n>10的事件概率都非常小了，那么我们做累计分布的时候只画出[0,10]的部分就好，如下图。

![picture](http://ww1.sinaimg.cn/mw690/6daafd01gw1f2itoqy3xxj20dc0dc74f.jpg)

如果我们采用常用的显著度$$\alpha = 0.05$$，即95%对应的分位数（n=5）。在我们的例子中，也就说如果转化用户数量>=5时，我们有足够的理由相信，抽样用户的转化率是显著大于0.005的。
